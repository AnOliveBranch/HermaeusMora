version: "3.9"

services:
  hermaeusmora:
    # Build from the local Dockerfile
    build: .
    image: hermaeusmora:latest
    container_name: hermaeusmora
    restart: unless-stopped
    env_file:
      - .env
    environment:
      # Set any runtime env here or via an .env file
      - NODE_ENV=production
      - DISCORD_TOKEN=${DISCORD_TOKEN}
      - GUILD_ID=${GUILD_ID}
      - CLIENT_ID=${CLIENT_ID}
      - LOG_INFO=${LOG_INFO}
      - LOG_VERBOSE=${LOG_VERBOSE}
      - LOG_ERRORS=${LOG_ERRORS}
      - INFO_LOG_CHANNEL_ID=${INFO_LOG_CHANNEL_ID}
      - ERROR_LOG_CHANNEL_ID=${ERROR_LOG_CHANNEL_ID}
    # Persist app data (e.g., tokens.json, config.json) inside /home/node/app/data
    # APP_DATA_DIR can be overridden via environment (defaults to ./data)
    volumes:
      - ${APP_DATA_DIR:-./data}:/home/node/app/data
      # Optionally override config.json from the host (uncomment to use):
      # - ${APP_CONFIG_FILE:-./config.json}:/home/node/app/config.json:ro
    # No ports are exposed; Discord bots connect outbound only
    # command: ["yarn", "start"] # Uses Dockerfile CMD by default
